
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>대피 행동 - 3단계 게임</title>
<style>
  :root{
    --bg1:#cfe7fb;
    --bg2:#c7e0f2;
    --circle: rgba(255, 90, 90, .65);
    --shadow: 0 10px 30px rgba(0,0,0,.15);
    /* ◎ Step2 성공 이미지(젖은수건 정답) 위치 보정치 - 사용자가 요청한 '왼쪽 2칸, 위쪽 1.5칸' 반영 */
    --ok-left: 40%;  /* 낮을수록 더 왼쪽. 기존 대비 좌측으로 이동 */
    --ok-top: 39.5%;  /* 낮을수록 더 위쪽. 기존 대비 위로 이동 */
    --ok-width: 22%; /* 낮은자세 그림(사각형) 기준 너비 - 성공 이미지 크기 */
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html,body{height:100%;}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial, sans-serif;
    background: linear-gradient(to bottom, var(--bg1), var(--bg2));
    overflow:hidden;
  }
  #app{ position:relative; width:100vw; height:100vh; }
  .screen{ position:absolute; inset:0; display:none; }
  .screen.active{ display:block; }
  .wrap{ position:absolute; inset:0; padding:min(3vw,24px); }
  .row{ position:relative; width:100%; height:100%; }
  .hint{ position:absolute; left:12px; bottom:12px; background:rgba(0,0,0,.35); color:#fff; padding:8px 12px; border-radius:10px; font-size:14px; }
  .arrow{ position:absolute; right:18px; top:18px; width:min(70px,10vw); aspect-ratio:1/1; cursor:pointer; display:none; }
  .arrow.show{ display:block; }

  /* 공통 원형 하이라이트 */
  .ring{ position:absolute; border:10px solid var(--circle); border-radius:999rem; pointer-events:none; animation:pop .22s ease-out both; }
  @keyframes pop{
    from{ transform: scale(.7); opacity:.4; }
    to{ transform: scale(1); opacity:1; }
  }

  /* Step1 레이아웃 */
  .figurebox{
    position:absolute; left:8%; top:10%; width:42%; height:76%;
    display:flex; align-items:center; justify-content:center;
  }
  .figurebox img{ width:100%; height:auto; box-shadow:var(--shadow); border-radius:8px; display:block; }
  .clickzone{ position:absolute; inset:0; cursor:pointer; }

  /* Step2 레이아웃 */
  .stage2-figure{ position:absolute; left:8%; top:10%; width:45%; height:78%; display:flex; align-items:center; justify-content:center;}
  .stage2-figure img{ width:100%; height:auto; border-radius:8px; box-shadow:var(--shadow); display:block; }

  .dragItem{
    position:absolute; right:8%; top:55%; width:28%;
    max-width:460px; touch-action:none; cursor:grab; user-select:none;
  }
  .dragItem.dragging{ cursor:grabbing; opacity:.9; }
  .dropzone{ position:absolute; inset:0; }
  .okTowel{
    position:absolute; width:var(--ok-width); left:var(--ok-left); top:var(--ok-top);
    transform: translate(-50%,-50%); display:none; pointer-events:none;
    filter: drop-shadow(0 6px 12px rgba(0,0,0,.18));
  }

  /* Step3 */
  .step3bg{ position:absolute; inset:0; background: center / cover no-repeat url('assets/stairs_vs_elevator.png'); }
  .stairsZone{ position:absolute; left:52%; top:22%; width:33%; height:60%; cursor:pointer; }
</style>
</head>
<body>
<div id="app">
  <!-- STEP 1 -->
  <section id="step1" class="screen active">
    <div class="wrap">
      <img id="next1" class="arrow" src="assets/arrow.png" alt="다음" />
      <div class="row">
        <div class="figurebox">
          <img src="assets/pose_low.png" alt="낮은자세" id="s1img">
          <div class="clickzone" id="s1zone" aria-label="낮은자세 정답 구역"></div>
        </div>
      </div>
      <div class="hint">낮은 자세 그림을 눌러 보세요.</div>
    </div>
  </section>

  <!-- STEP 2 -->
  <section id="step2" class="screen">
    <div class="wrap">
      <img id="next2" class="arrow" src="assets/arrow.png" alt="다음" />
      <div class="row">
        <div class="stage2-figure" id="s2fig">
          <img src="assets/pose_low_fig.png" alt="낮은자세 그림" id="s2img">
          <div class="dropzone" id="drop2"></div>
          <img src="assets/wet_towel_ok.png" class="okTowel" id="okTowel" alt="젖은수건 정답">
        </div>
        <img src="assets/wet_towel.png" id="towel" class="dragItem" draggable="false" alt="젖은 수건">
      </div>
      <div class="hint">수건을 낮은 자세 그림 위에 드롭하면 정답! (드롭 후 수건은 사라져요)</div>
    </div>
  </section>

  <!-- STEP 3 -->
  <section id="step3" class="screen">
    <div class="wrap">
      <div class="row">
        <div class="step3bg"></div>
        <div class="stairsZone" id="stairs"></div>
      </div>
    </div>
  </section>

  <audio id="correctSound" preload="auto" src="assets/correct.wav"></audio>
</div>

<script>
(function(){
  const $ = (sel, p=document)=>p.querySelector(sel);
  const step1 = $("#step1"), step2 = $("#step2"), step3 = $("#step3");
  const next1 = $("#next1"), next2 = $("#next2");
  const snd = $("#correctSound");

  // 공통: 스크린 전환
  function show(id){
    [step1, step2, step3].forEach(s=>s.classList.remove('active'));
    $(id).classList.add('active');
  }

  /* STEP 1 */
  const s1zone = $("#s1zone");
  let s1cleared = false;
  s1zone.addEventListener('click', ()=>{
    if(s1cleared) return;
    s1cleared = true;
    // 클릭한 사각형 위에 고정 원형 표시
    const box = s1zone.getBoundingClientRect();
    drawRing(step1, box.left + box.width/2, box.top + box.height/2, Math.min(box.width, box.height)/2 - 10);
    snd.currentTime = 0; snd.play();
    next1.classList.add('show');
    s1zone.style.pointerEvents = "none";
  });
  next1.addEventListener('click', ()=>show("#step2"));

  /* STEP 2 – drag & drop */
  const towel = $("#towel");
  const drop2 = $("#drop2");
  const okTowel = $("#okTowel");
  let s2cleared = false;

  // 간단 드래그(마우스+터치)
  let dragging=false, sx=0, sy=0, ox=0, oy=0;
  const startDrag = (x,y)=>{ dragging=true; sx=x; sy=y; const r=towel.getBoundingClientRect(); ox=r.left; oy=r.top; towel.classList.add('dragging'); }
  const moveDrag = (x,y)=>{ if(!dragging) return; const dx=x-sx, dy=y-sy; towel.style.left=(ox+dx)+"px"; towel.style.top=(oy+dy)+"px"; towel.style.position="fixed"; }
  const endDrag = (x,y)=>{
    if(!dragging) return; dragging=false; towel.classList.remove('dragging');
    // 드롭 판정: 낮은자세 그림 사각형 내부면 성공
    const dz = drop2.getBoundingClientRect();
    const t = towel.getBoundingClientRect();
    const cx = t.left + t.width/2, cy = t.top + t.height/2;
    const inside = (cx>dz.left && cx<dz.right && cy>dz.top && cy<dz.bottom);
    if(inside && !s2cleared){
      s2cleared = true;
      towel.style.display="none";         // 수건 제거
      okTowel.style.display="block";      // 정답 수건 표시(위치/크기는 CSS 변수로 조정)
      snd.currentTime = 0; snd.play();
      next2.classList.add('show');
      drop2.style.pointerEvents="none";
    }else{
      // 실패 시 원위치
      towel.style.position=""; towel.style.left=""; towel.style.top="";
    }
  };

  towel.addEventListener('mousedown', e=>startDrag(e.clientX,e.clientY));
  window.addEventListener('mousemove', e=>moveDrag(e.clientX,e.clientY));
  window.addEventListener('mouseup', e=>endDrag(e.clientX,e.clientY));

  towel.addEventListener('touchstart', e=>{const t=e.touches[0]; startDrag(t.clientX,t.clientY);}, {passive:true});
  window.addEventListener('touchmove', e=>{const t=e.touches[0]; moveDrag(t.clientX,t.clientY);}, {passive:false});
  window.addEventListener('touchend', e=>{const t=(e.changedTouches||[{}])[0]; endDrag(t?.clientX||0, t?.clientY||0);});

  next2.addEventListener('click', ()=>show("#step3"));

  /* STEP 3 – 계단 선택 */
  const stairs = $("#stairs");
  let s3cleared=false;
  stairs.addEventListener('click', (e)=>{
    if(s3cleared) return;
    s3cleared = true;
    const r = stairs.getBoundingClientRect();
    drawRing(step3, r.left + r.width/2, r.top + r.height/2, Math.min(r.width, r.height)*.45);
    snd.currentTime = 0; snd.play();
  });

  /* 원형 그리기 */
  function drawRing(screen, cx, cy, radius){
    const ring = document.createElement('div');
    ring.className = 'ring';
    const bw = 10;
    Object.assign(ring.style, {
      left: (cx - radius - bw) + "px",
      top: (cy - radius - bw) + "px",
      width: (radius*2) + "px",
      height: (radius*2) + "px",
      borderWidth: bw + "px",
    });
    document.body.appendChild(ring);
    // 고정 표시: 제거하지 않음
  }

  // 첫 화면 보장
  show("#step1");
})();
</script>
</body>
</html>
